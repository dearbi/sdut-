# 肿瘤数智化筛查 初赛解决方案报告

版本：v0.2.0（原型更新）
团队：山理工神思妙想队
对应需求文档：`/C:/Users/21994/OneDrive/Desktop/创新赛道/requirement.markdown`

---

## 一、项目背景与目标

- 背景：全球癌症负担持续攀升，传统筛查在效率、准确性、可解释性与用户体验方面存在瓶颈。数字化与智能技术为早筛提供新路径。
- 痛点：数据敏感与异构、模型黑箱难被临床接受、系统集成复杂、交互体验不统一。
- 总体目标：构建一套可运行的“肿瘤数智化筛查”原型，支持多模态输入、风险评估、可解释输出与个性化报告，具备后台管理与资源排班能力，满足初赛文档与原型演示要求。

---

## 二、范围与原则

- 范围：
  - 前端：筛查页面、结果展示、报告生成、后台管理（登录/仪表盘/用户/患者/资源/排班）。
  - 后端：评估与报告 API、管理端认证与RBAC、基础资源与排班 API、CORS 配置。
  - 数据与模型：合成数据、结构化与图像特征融合、轻量可解释逻辑回归。
- 原则：
  - 隐私与最小采集：默认匿名输入，不持久化原始影像与患者信息。
  - 可解释与可用：输出关键因素与建议，接口稳定、前后端分离、部署可行。
  - 演示优先：原型聚焦端到端流畅与清晰交互。

---

## 三、系统架构与技术选型

- 架构：前后端分离
  - 前端（Vue 3 + Vite）→ 开发代理 `/api` → 后端（FastAPI）
  - 管理端采用路由守卫 + Axios 拦截器注入 JWT
- 关键技术：
  - 前端：`Vue 3`、`Vue Router`、`Axios`、`Vite`
  - 后端：`FastAPI`、`Uvicorn`、`Pydantic`、`Numpy/Pillow`、`scikit-learn`
- 重要路径：
  - 前端：`frontend/src/App.vue`、`frontend/src/views/Screening.vue`、`frontend/src/router/index.js`、`frontend/src/services/api.js`、`frontend/vite.config.js`
  - 后端：`backend/app/main.py`、`backend/app/routers_admin.py`、`backend/app/auth.py`、`backend/app/models.py`
- CORS 与联调：
  - 后端 `allow_origins=["http://localhost:5173", "http://127.0.0.1:5173"]`，支持携带 `Authorization` 的跨域请求。
  - 前端 Axios `baseURL=http://localhost:8000`；开发态仅保留 `/api` 代理以避免与 `/admin` 前端路由冲突。

---

## 四、功能模块

- 前台筛查模块
  - 多模态输入：年龄、BMI、吸烟/饮酒/家族史、症状评分、CEA、CA-125、影像上传。
  - 结果展示：风险分值/等级、关键影响因素（Top factors）、建议文案。
  - 报告生成：后端返回 HTML 报告，前端一键打印/保存。
- 管理端模块
  - 登录认证：`/admin/auth/login`（JWT），路由守卫与拦截器自动跳转登录。
  - 仪表盘：总体计数与风险分布。
  - 用户/患者/资源/排班管理：基础 CRUD 与列表页。
- 安全与隐私
  - 不持久化原始影像与个人数据；最小采集原则；基于角色的访问控制（RBAC）。

---

## 五、数据与算法设计

- 合成数据：构造结构化特征分布，避免隐私与采集难题。
- 图像特征：利用 Pillow/Numpy 提取灰度统计、方差、简化边缘强度，作为影像补充特征。
- 模型：`StandardScaler + LogisticRegression`
  - 训练一次，预测低开销，适合原型演示。
  - 可解释性：对标准化特征与系数做点积，按绝对值排序输出 Top 因素。
- 风险分级：根据分值设阈值，输出等级（例如：低/中/高）与建议。

---

## 六、接口设计（关键API）

### 1) 风险评估

- `POST /api/v1/assess`（multipart）
- 入参：
  - `payload`: JSON字符串，字段：`age,bmi,smoking,alcohol,family_history,symptom_score,lab_cea,lab_ca125`
  - `image`: 可选影像文件（PNG/JPG）
- 返回：

```json
{
  "risk_score": 0.37,
  "risk_level": "中风险",
  "top_factors": {"age": 0.4231, "symptom_score": 0.3120, "lab_cea": 0.1987},
  "recommendations": "建议进一步检查，注意生活方式管理。"
}
```

- 示例（cURL）：

```bash
curl -X POST http://localhost:8000/api/v1/assess \
  -F payload='{"age":45,"bmi":24,"smoking":false,"alcohol":false,"family_history":false,"symptom_score":3,"lab_cea":3,"lab_ca125":20}' \
  -F image=@sample.png
```

### 2) 报告生成

- `POST /api/v1/report`（JSON）
- 入参：

```json
{
  "patient": {"name": "匿名", "age": 45},
  "result": {"risk_score": 0.37, "risk_level": "中风险", "top_factors": {"age": 0.42}}
}
```

- 返回：

```json
{ "format": "html", "content": "<html>...</html>" }
```

### 3) 健康检查

- `GET /api/v1/health` → `{ "status": "ok" }`

### 4) 管理端认证与仪表盘

- 登录：`POST /admin/auth/login` → `{ access_token: "jwt..." }`
- 仪表盘：`GET /admin/dashboard/metrics`
- 用户/患者/资源/排班：`/admin/users`、`/admin/patients`、`/admin/resources`、`/admin/schedules`
- 前端：路由守卫与拦截器对 `/admin` 进行 JWT 注入与未授权重定向。

---

## 七、前端交互与UI规范

- 页面结构：
  - 首页：`Screening.vue` 输入与评估；结果卡片与报告按钮。
  - 管理端：`AdminLayout.vue` 侧栏导航，`AdminLogin.vue` 登录表单，数据页与仪表盘。
- 统一样式：
  - 文本输入高度 `42px`、圆角 `10px`、满宽 `100%`；按钮与输入同高；复选框统一 `18px`，选中金色对勾，深色主题适配。
  - 网格排版：桌面端三列，移动端单列；对齐与间距统一。
- 资源与路由：
  - 首页 Logo `./logo.png`（相对路径）
  - 管理端路由前缀 `/admin`，避免与开发代理冲突。

---

## 八、实施步骤

1. 环境准备
   - 后端：Python 3.10+；安装依赖：`python -m pip install -r backend/requirements.txt`
   - 前端：Node.js 18+；`cd frontend && npm install`
2. 启动与联调
   - 后端：`python -m uvicorn app.main:app --host 0.0.0.0 --port 8000`
   - 前端：`npm run dev`（默认 `http://localhost:5173/`）
3. 关键配置
   - Axios `baseURL=http://localhost:8000`（避免 `/admin` 代理冲突）
   - 后端 CORS 白名单收敛，支持带凭证跨域
4. 流程演示
   - 在首页填写信息与上传影像 → 点击“评估风险”→ 查看分值/等级/Top因素 → 生成报告
   - 管理端登录（默认 `admin/123456`）→ 查看仪表盘与各管理页

---

## 九、测试与运行保障

- 冒烟测试：
  - `GET /api/v1/health` 返回 `{status: 'ok'}`
  - 评估与报告接口正常返回；影像解析失败时走默认特征回退。
- 前端验证：
  - 管理端登录跳转与 JWT 注入；未授权自动重定向登录。
  - 跨域与预检：OPTIONS 成功、Authorization 头携带正常。
- 性能与稳定性：
  - 训练一次，预测快速；错误捕获与提示；UI 统一规范避免布局抖动。

---

## 十、部署与运维方案（复赛/决赛可行性）

- 后端：Nginx 反向代理与 TLS，域名白名单与CORS收敛，日志脱敏与审计。
- 前端：静态资源部署（Nginx/Netlify），使用环境变量配置后端地址。
- 监控与告警：接口错误率、响应时间、可用性；审计与访问日志。

---

## 十一、数据安全与隐私

- 数据最小化：仅采集风险评估所需字段，默认匿名。
- 非持久化策略：不存储原始影像与个人信息；会话级处理。
- 访问控制：管理端基于角色与令牌的授权；最小权限原则。

---

## 十二、风险与应对

- 数据偏差与泛化风险 → 后续接入真实标注与更强模型（CNN/ViT + TabNet/DeepFM）；阈值校准与不确定性估计。
- 跨域与权限问题 → 后端白名单与预检支持；前端拦截器与路由守卫。
- 资源管理复杂度 → 迭代完善数据模型，增加校验与状态流转。

---

## 十三、KPI 与评估指标

- 交互体验：表单提交成功率、评估响应时间（目标 < 1s）、移动端适配通过率。
- 系统稳定：接口错误率与可用性（目标 ≥ 99% 开发态）。
- 可解释输出：Top 因素覆盖率与一致性（与领域规则一致的比例）。
- 管理端：基础 CRUD 完整度与仪表盘可视化覆盖度。

---

## 十四、预期成果与演示

- 交付物：可运行原型系统（前后端）、解决方案报告（本文档）、接口文档与演示脚本。
- 演示流程：多模态输入 → 风险评估与解释 → 报告生成 → 管理端查看与资源管理。

---

## 竞赛要求对齐说明

- 智能化筛查模型设计：
  - 合成数据 + 结构化与影像特征融合；轻量逻辑回归与解释输出。
- 用户交互体验：
  - 友好表单、统一控件尺寸与样式、结果展示与报告生成；后台管理闭环。
- 系统集成方案：
  - FastAPI 标准化接口；前后端分离与代理；隐私与安全策略；可部署建议。
- 创新要求：
  - 多模态与可解释轻量模型；后续可扩展联邦与更强模型；原型演示完整、可落地。

---

## 附录：文件结构与关键路径

- 后端：`backend/requirements.txt`，`backend/app/main.py`
- 前端：`frontend/package.json`，`frontend/vite.config.js`，`frontend/index.html`，`frontend/src/*`
- 报告：`docs/初赛解决方案报告.md`

### 示例：前端到后端的数据流

1) 前端 `Screening.vue` 采集表单与影像 → 构造 `FormData`：`payload + image`
2) Axios POST 至 `http://localhost:8000/api/v1/assess`
3) 后端解析结构化与影像特征 → 预测与解释 → 返回风险指标
4) 前端展示并支持报告生成：POST `/api/v1/report`

---

> 注：本原型仅用于技术演示，不替代临床诊断。正式部署需进一步增强隐私合规、模型性能与系统可靠性。
